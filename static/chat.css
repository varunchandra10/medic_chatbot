/* ===========================
   Theme variables (Light = default)
   Palette D: soft purple (primary)
   =========================== */
:root{
  --primary: #6D5DD3;
  --primary-600: #5b4ac0;
  --accent: #7f6fe0;
  --bg-page: #f6f7fb;
  --bg-panel: #ffffff;
  --bg-sidebar: #ffffff;
  --bg-header: #ffffff;
  --bg-composer: #fbfbfd;
  --msg-user: var(--primary);
  --msg-bot: #f4f6fb;
  --text-primary: #0f1724;
  --text-muted: #596273;
  --border: #e6e9f2;
  --danger: #e74c3c;
  --success: #16a34a;
  --shadow: 0 6px 24px rgba(16,24,40,0.06);
  --hover-sidebar: rgba(109,93,211,0.06);
  --z-sidebar: 50; /* Z-index for the sidebar overlay */
  --z-dropdown: 40; /* Z-index for dropdowns */
}

/* DARK theme overrides (applied when body has .dark) */
body.dark{
  --bg-page: #0b1020;
  --bg-panel: #0f1724;
  --bg-sidebar: #0b1220;
  --bg-header: #0b1220;
  --bg-composer: #0f1724;
  --msg-user: #6D5DD3;
  --msg-bot: #172033;
  --text-primary: #e6eef6;
  --text-muted: #94a3b8;
  --border: #19232f;
  --shadow: 0 10px 30px rgba(2,6,23,0.6);
}

/* ===========================
   Base & Layout
   =========================== */
html,body{height:100%;margin:0;font-family:'Inter',ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;}
body{
  background:var(--bg-page);
  color:var(--text-primary);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  transition: background 0.3s, color 0.3s; /* Smooth theme transition */
}
.app-shell{
  display:flex;
  height:100vh;
  overflow:hidden;
}

/* ===========================
   Sidebar (Desktop & Mobile Drawer)
   =========================== */
.sidebar{
  width:18rem;
  flex-shrink:0;
  background:var(--bg-sidebar);
  border-right:1px solid var(--border);
  padding:1.1rem;
  box-shadow:var(--shadow);
  display:flex;
  flex-direction:column;
  transition: transform 0.3s ease-in-out, box-shadow 0.3s; /* Add transform transition */
}

/* Mobile: Sidebar as an off-canvas menu */
@media (max-width: 900px) {
  .sidebar {
    position: fixed;
    left: 0;
    top: 0;
    bottom: 0; /* Ensure it covers full height */
    z-index: var(--z-sidebar);
    transform: translateX(-100%);
    /* Stronger shadow for mobile overlay */
    box-shadow: 0 0 30px rgba(0, 0, 0, 0.3); 
    width: 16rem; /* Slightly smaller width on mobile */
  }
  .sidebar.open {
    transform: translateX(0);
  }
}

.top-row{display:flex;align-items:center;justify-content:space-between;gap:.6rem;margin-bottom:1rem}
.brand{display:flex;align-items:center;gap:.6rem;font-weight:700;color:var(--primary);font-size:1.05rem}
.nav-links{display:flex;flex-direction:column;gap:.5rem}
.new-chat{display:flex;align-items:center;gap:.6rem;border-radius:.7rem;background:linear-gradient(90deg,var(--primary),var(--accent));color:white;padding:.6rem .8rem;border:none;cursor:pointer;transition:opacity 0.2s}
.new-chat:hover{opacity:0.9}

/* Sidebar links */
.sidebar-link{
  padding:.55rem .6rem;
  border-radius:.6rem;
  color:var(--text-muted);
  transition:background .2s, color .2s;
  display:flex;
  align-items:center;
  gap:.6rem;
}
.sidebar-link i{color:var(--text-muted); transition:color .2s}
.sidebar-link:hover{background:var(--hover-sidebar);color:var(--text-primary)}
.sidebar-link:hover i{color:var(--primary)}

/* Sidebar Bottom (User/Theme controls) */
.sidebar-bottom{margin-top:auto;padding-top:1rem;border-top:1px solid var(--border);display:flex;flex-direction:column;gap:.8rem}
.btn-ghost{background:transparent;border:1px solid transparent;padding:.55rem;border-radius:8px;cursor:pointer;display:flex;align-items:center;gap:.5rem;color:var(--text-muted);transition:background .2s, color .2s}
.btn-ghost:hover{background:var(--hover-sidebar);color:var(--text-primary)}
.btn-ghost.logout{color:var(--danger)}
.btn-primary{background:linear-gradient(90deg,var(--primary),var(--accent));color:white;padding:.55rem .7rem;border-radius:10px;border:none;cursor:pointer;transition:opacity 0.2s}
.btn-primary:hover{opacity:0.9}

/* ===========================
   Header & Main Panel
   =========================== */
.panel{
  flex:1;
  display:flex;
  flex-direction:column;
  background:var(--bg-panel);
  min-width:0; /* Fixes overflow issues in flex container */
}
.header{
  height:64px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 1rem;
  border-bottom:1px solid var(--border);
  background:var(--bg-header);
  flex-shrink: 0; /* Prevent header from shrinking */
}
.header-left{display:flex;align-items:center;gap:.75rem}
.header-left h1{font-size:1rem;margin:0;font-weight:600}
.header-center{flex:1;display:flex;align-items:center;justify-content:center;padding:0 .5rem;min-width:0} /* Added min-width:0 */
.header-right{display:flex;align-items:center;gap:.6rem;position:relative}
.header-avatar{height:2.25rem;width:2.25rem;border-radius:9999px;background:var(--primary);color:white;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:1rem;flex-shrink:0}

/* Language controls */
.lang-pills{display:flex;gap:.45rem}
.lang-pill{padding:.35rem .6rem;border-radius:999px;font-size:.82rem;border:1px solid var(--border);background:transparent;color:var(--text-muted);cursor:pointer;transition:all 0.2s}
.lang-pill:hover{border-color:var(--primary)}
.lang-pill.active{background:linear-gradient(90deg,var(--primary)20%,var(--accent));color:white;border-color:var(--primary)}
.lang-dropdown{display:none} /* Hidden by default on desktop */

/* Desktop vs Mobile Language Controls */
@media(max-width:900px){ 
  /* Mobile: Center is now left-aligned and uses dropdown */
  .header-center { justify-content: flex-start; }
  .lang-pills{display:none !important} 
  .lang-dropdown{display:block !important} 
}
@media(min-width:901px){
  /* Desktop: Use pills */
  .lang-pills{display:flex !important} 
  .lang-dropdown{display:none !important}
  /* Show menu toggle on mobile only */
  .md\:hidden { display: none !important; }
}

/* User Dropdown */
.dropdown{
  position:absolute;
  right:0;
  top:100%;
  margin-top:.6rem;
  background:var(--bg-panel);
  border:1px solid var(--border);
  padding:.5rem;
  border-radius:8px;
  min-width:12rem;
  box-shadow:var(--shadow);
  display:none;
  z-index: var(--z-dropdown);
  opacity: 0;
  transform: translateY(-10px);
  transition: opacity 0.2s, transform 0.2s;
}
.dropdown.show{
  display:block;
  opacity: 1;
  transform: translateY(0);
}
.dropdown-name{font-weight:600;padding:0 .5rem}
.dropdown-email{font-size:.85rem;color:var(--text-muted);padding:0 .5rem;margin-bottom:.5rem}
.dropdown-logout{border-top:1px solid var(--border);padding-top:.5rem;margin-top:.5rem}
.dropdown-logout .btn-ghost{width:100%;justify-content:center}


/* ===========================
   Chat Area & Messages
   =========================== */
.chat-area{
  display:flex;
  flex-direction:column;
  flex:1;
  min-height:0; /* Important for flex child */
}
.messages{
  flex:1;
  overflow-y:auto; /* Use overflow-y for scroll */
  padding:1.25rem;
  display:flex;
  flex-direction:column;
  gap:.8rem;
  background:transparent;
  scroll-behavior: smooth; /* Smooth scrolling for new messages */
}
.msg{
  display:flex;
  gap:.6rem;
  align-items:flex-start; /* Align messages to top of bubble, not bottom */
  max-width:90%;
}
.msg.user{justify-content:flex-end;align-self:flex-end}
.msg.user .bubble{border-radius:12px 12px 2px 12px;} /* Tail for user */
.msg.bot .bubble{border-radius:12px 12px 12px 2px;} /* Tail for bot */

.bubble{
  padding:.7rem 1rem;
  line-height:1.45;
  border:1px solid var(--border);
  background:var(--msg-bot);
  color:var(--text-primary);
  max-width:100%; /* Use 100% of the parent .msg container's max-width */
}
.bubble.user{background:var(--msg-user);color:white;border:none}

/* Fix Markdown rendering inside bubbles */
.bubble h1, .bubble h2, .bubble h3, .bubble h4 { font-weight: 600; margin-top: 1rem; margin-bottom: 0.5rem; }
.bubble p { margin: 0.5rem 0; }
.bubble code { background: rgba(0,0,0,0.05); padding: 2px 4px; border-radius: 4px; font-size: 0.9em; }
body.dark .bubble code { background: rgba(255,255,255,0.1); }
.bubble pre { padding: 10px; background: rgba(0,0,0,0.05); border-radius: 6px; overflow-x: auto; font-size: 0.9em; }
body.dark .bubble pre { background: rgba(255,255,255,0.1); }
.bubble ul, .bubble ol { padding-left: 20px; margin: 0.5rem 0; }
.bubble table { width: 100%; border-collapse: collapse; margin: 10px 0; font-size: 0.9em; }
.bubble th, .bubble td { border: 1px solid var(--border); padding: 8px; text-align: left; }
.bubble th { background: var(--bg-composer); font-weight: 600; }


/* ===========================
   Composer & Input
   =========================== */
.composer{
  padding:1rem;
  border-top:1px solid var(--border);
  background:var(--bg-composer);
  display:flex;
  gap:.6rem;
  align-items:flex-end;
  flex-shrink: 0;
}
.composer textarea{
  flex:1;
  padding:.7rem .85rem;
  border-radius:10px;
  border:1px solid var(--border);
  background:transparent;
  color:var(--text-primary);
  min-height:44px;
  max-height:220px;
  resize:none;
  font-size:0.95rem;
  line-height: 1.4;
  transition: border-color 0.2s, background 0.2s;
}
.composer textarea:focus{
  border-color: var(--primary);
  outline: none;
}
.composer .actions{
  display:flex;
  gap:.45rem;
  align-items:center;
  flex-shrink: 0;
}
.composer .actions .btn-primary{
  height: 44px;
  width: 44px;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 1.1rem;
}
.composer .actions .btn-ghost{
  height: 44px;
  width: 44px;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 1.1rem;
}

/* ===========================
   Tips Panel (Drawer)
   =========================== */
.tips{
  position:fixed;
  right:1rem;
  top:72px;
  width:20rem; /* Slightly wider tips panel */
  background:var(--bg-panel);
  border:1px solid var(--border);
  padding:1rem;
  border-radius:10px;
  box-shadow:var(--shadow);
  /* Use transform for cleaner open/close animation */
  transform: translateX(25rem); 
  transition: transform 0.3s ease-in-out;
  z-index: var(--z-dropdown);
}
.tips.open{
  transform: translateX(0);
}
.tips-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:.6rem;font-weight:600}
.tips-list{margin:0;padding-left:1.5rem;color:var(--text-muted);line-height:1.6;list-style-type: disc;}
.tips-list li{margin-bottom: .5rem;}

/* ===========================
   Final Responsive Tweaks (Mobile Overrides)
   =========================== */
@media(max-width:900px){
  /* Hide desktop header elements */
  .header-left h1 { display: none; }
  /* Ensure tips panel is full-width minus padding on mobile */
  .tips{
    right: 0;
    left: 0;
    margin: 0 auto;
    width: 90%; 
    top: 68px; /* Slightly lower */
    /* Adjust transform for proper mobile view */
    transform: translateY(-200%);
    box-shadow: var(--shadow);
  }
  .tips.open{
    transform: translateY(0);
  }

  /* Language dropdown already covered by lang-pills/lang-dropdown rules above */
}

/* ===========================
   Disclaimer Styling (Crisp, Centered, Themed)
   =========================== */
.disclaimer {
    /* Positioning & Box Model */
    padding: 0.75rem 1rem;
    margin: 0 1rem 0.5rem 1rem;
    
    /* Typography & Alignment */
    font-size: 0.85rem; /* Same size as general system text */
    line-height: 1.4;
    text-align: center; /* Center the text */

    /* Colors and Appearance */
    color: var(--text-muted); /* Muted color for secondary text */
    background-color: var(--bg-composer); 
    border: 1px solid var(--border);
    border-radius: 8px;
    
    /* Ensure crisp lines (using padding/margins on inner elements) */
}

/* Style the inner paragraphs for crisp line separation */
.disclaimer p {
    margin: 0.2rem 0;
    padding: 0;
    font-size: 10px;
}

/* Highlight key warnings */
.disclaimer b {
    color: var(--text-primary); /* Use primary text color for emphasis */
}

/* Style the 'Under Development' status line */
.disclaimer .status {
    font-style: italic;
    margin-top: 0.5rem;
    color: red; /* Use a distinct color for status/disclaimer reminder */
}

/* Dark Mode Overrides for Disclaimer */
body.dark .disclaimer {
    background-color: var(--bg-composer);
    border-color: var(--border);
}
body.dark .disclaimer b {
    color: var(--text-primary);
}

.has-tooltip {
    position: relative;
}

.tooltip-text {
    /* Tooltip Appearance */
    visibility: hidden;
    opacity: 0;
    width: 100px; /* Fixed width for the text */
    background-color: var(--text-primary); /* Dark background */
    color: white; /* Light text */
    text-align: center;
    padding: 4px 6px;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 500;
    white-space: nowrap; /* Keep text on one line */
    transition: opacity 0.3s;

    /* Positioning */
    position: absolute;
    z-index: 10;
    bottom: calc(100% + 8px); /* Position 8px above the button */
    left: 50%; /* Start at 50% from the left */
    transform: translateX(-50%); /* Shift back 50% of its own width to center */
}

/* Tooltip Arrow (Triangle) */
.tooltip-text::after {
    content: "";
    position: absolute;
    top: 100%; /* Position at the bottom edge */
    left: 50%;
    margin-left: -5px; /* Half the size of the triangle */
    border-width: 5px;
    border-style: solid;
    border-color: var(--text-primary) transparent transparent transparent; /* Dark triangle pointing down */
}

/* Show the tooltip on hover over the button */
.has-tooltip:hover .tooltip-text {
    visibility: visible;
    opacity: 1;
}

/* Ensure the disabled button still looks muted */
.disabled-btn {
    opacity: 0.5;
    cursor: not-allowed;
    /* Removed pointer-events: none in CSS so hover still works on the container */
}